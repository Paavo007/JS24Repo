<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator</title>
    <link rel="stylesheet" href="laskin.css">
</head>
<body>
    <div class="container">
        <div class="display">
            <textarea id="screen" placeholder="0" rows="4" cols="50"></textarea>
        </div>
        <div class="btns">
            <div class="row">
                <button id="ce" onclick="backspc()">CE</button>
                <button onclick="fact()">x!</button>
                <button onclick="appendText('(')">(</button>
                <button onclick="appendText(')')">)</button>
                <button onclick="appendText('%')">%</button>
                <button id="ac" onclick="clearScreen()">AC</button>
            </div>

            <div class="row">
                <button onclick="sin()">sin</button>
                <button onclick="pi()">π</button>
                <button onclick="appendText('7')">7</button>
                <button onclick="appendText('8')">8</button>
                <button onclick="appendText('9')">9</button>
                <button onclick="appendText('/')">÷</button>
            </div>

            <div class="row">
                <button onclick="cos()">cos</button>
                <button onclick="log()">log</button>
                <button onclick="appendText('4')">4</button>
                <button onclick="appendText('5')">5</button>
                <button onclick="appendText('6')">6</button>
                <button onclick="appendText('*')">x</button>
            </div>

            <div class="row">
                <button onclick="tan()">tan</button>
                <button onclick="sqrt()">√</button>
                <button onclick="appendText('1')">1</button>
                <button onclick="appendText('2')">2</button>
                <button onclick="appendText('3')">3</button>
                <button onclick="appendText('-')">-</button>
            </div>

            <div class="row">
                <button onclick="e()">e</button>
                <button onclick="pow()">x<sup>y</sup></button>
                <button onclick="appendText('0')">0</button>
                <button onclick="appendText('.')">.</button>
                <button id="eval" onclick="evaluateExpression()">=</button>
                <button onclick="appendText('+')">+</button>
            </div>
        </div>
    </div>
</body>

<script>
    var screen = document.querySelector('#screen');
    var historyArray = [];  // Array to store calculation history

    // Append text to the screen based on input
    function appendText(text) {
        screen.value += text;
    }

    function sin() {
        appendText('sin(');  // Append sin(
    }

    function cos() {
        appendText('cos(');  // Append cos(
    }

    function tan() {
        appendText('tan(');  // Append tan(
    }

    function log() {
        appendText('log(');  // Append log(
    }

    function pow() {
        appendText('**');  // Append ** for exponentiation
    }

    function sqrt() {
        appendText('sqrt(');  // Append sqrt notation
    }

    function pi() {
        appendText('3.141592653589793');  // Append the value of π
    }

    function e() {
        appendText('2.718281828459045');  // Append the value of e
    }

    function fact() {
        appendText('fact(');  // Append factorial
    }

    function backspc() {
        screen.value = screen.value.substr(0, screen.value.length - 1);
    }

    function clearScreen() {
        screen.value = '';
        historyArray = [];  // Clear the history array
    }

    // Update the display with the history
    function updateDisplay() {
        screen.value = historyArray.join('\n');  // Join the history array and display it
    }

    // Improved evaluateExpression function with history saving
    function evaluateExpression() {
        let expr = screen.value;

        // Replace mathematical functions with JavaScript's Math functions
        expr = expr.replace(/sin\(/g, 'Math.sin(');
        expr = expr.replace(/cos\(/g, 'Math.cos(');
        expr = expr.replace(/tan\(/g, 'Math.tan(');
        expr = expr.replace(/log\(/g, 'Math.log(');
        expr = expr.replace(/sqrt\(/g, 'Math.sqrt(');

        // Factorial calculation (fact(x))
        expr = expr.replace(/fact\(([^)]+)\)/g, function (match, p1) {
            return factorial(p1);
        });

        try {
            // Evaluate the expression
            let result = eval(expr);

            if (isNaN(result) || !isFinite(result)) {
                throw new Error("Invalid Calculation");
            }

            // Add current expression and result to the history array
            historyArray.push(screen.value + ' = ' + result);

            // Clear the input screen
            screen.value = '';

            // Update the display with history
            updateDisplay();

        } catch (error) {
            // Display an error if evaluation fails
            screen.value = 'Error';
        }
    }

    // Factorial function for 'fact()'
    function factorial(n) {
        n = parseInt(n);
        if (isNaN(n) || n < 0) return NaN;  // Factorial is not defined for negative numbers or non-numeric input
        if (n === 0) return 1;  // 0! is 1
        let f = 1;
        for (let i = 1; i <= n; i++) {
            f *= i;
        }
        return f;
    }
</script>

</html>
